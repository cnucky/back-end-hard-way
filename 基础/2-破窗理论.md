# 软件研发中的《破窗理论》

美国心理学家詹巴斗曾进行过一项有趣的试验：把两辆一模一样的汽车分别停放在两个不同 的街区。其中一辆原封不动地停放在帕罗阿尔托的中产阶级社区；而另一辆则摘掉车牌、打 开顶棚，停放在相对杂乱的布朗克斯街区。结果，停放在中产街区的那一辆，过了一个星期 还完好无损；而打开顶棚的那一辆，不到一天就被偷走了。于是，詹巴斗又把完好无损的那 辆汽车敲碎一块玻璃，结果刚过了几小时，这辆汽车就不见了。
以这项试验为基础，美国政治学家威尔逊和犯罪学家凯林提出了破窗理论。他们认为： 如果有人打坏了一个建筑物的窗户玻璃，而这扇窗户又得不到及时的维修，别人就可能受到 某些暗示性的纵容，去打烂更多的窗户玻璃。久而久之，这些破窗户就给人造成一种无序的 感觉。结果在这种公众麻木不仁的氛围中，犯罪就会滋生、繁荣。
软件系统，从大到跨国公司，小到国内公司，不存在完美的系统，而可以被认为“破窗”的系统居多。

作为一个研发管理者，如果不采取正确的措施，“破窗”的系统，会像毒药一样，吞噬开发人员的斗志，让系统散发着臭味，人人讨厌。

从理论上分析，“破窗”系统使开发人员产生：

颓丧心理。Bug没人修，代码不规范没人管，大家对系统的信任度就会随之而降 低。
弃旧心理。既然已到处是坏味道，既然没人管，那就随它去吧。
从众心理。代码是公司的，别人能够这么写，我就可以；别人能够不管坏味道，我就 可以不管。
投机心理。 投机 是人的劣根性之一，尤其是看到有机可乘或者投机者占到 便宜 的时候。



## 重构

重构（名词上的定义）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。重构（动词上的定义）：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。在项目开发过程中，两顶帽子的故事：如果我们把项目开发过程中的添加新功能、以及重构想象成两顶帽子的话。那么在添加新功能时，你不应该修改既有代码，只管添加新功能。通过测试，你可以衡量自己的工作进度。重构时你就不能再添加功能，只管改进程序结构，此时你不应该添加任何测试，只在绝对必要时才修改测试。但是这两顶帽子，我们在实际的项目开发过程中，往往需要来回的替换，具体可看自己的项目进度衡量。

      在软件设计里面有个著名的破窗理论，大意为：在一座新房子里面，一旦开始出现一扇破窗，那么这扇破窗的下面将很快出现垃圾，同时房子的其他部分都将陆续出现破败的情况。将这个破窗理论借用到我们软件开发中，我们将会看到一个原来设计很好的架构系统，如果不注意维护的话，那么将很快出现第一个代码上的破窗。这个时候，如果我们不注意及时重构修补的话，那么破窗效应将蔓延，最终整个项目有可能面临失控的危险。所以重构带来的第一个好处，将是改进软件设计。

      常常会有人有疑问，在项目里面是不是应该拨出专门的时间用于代码重构呢？答案是否定的，重构应该是随时随地进行，你不应该为重构而重构，因为你想做别的什么事时，重构可以帮助你把那些事情做好。Don Roberts给了我们一条准则：第一次做某件事时只管去做；第二次做类似的事会产生反感，但是无论如何还是可以去做；第三次再做类似的事，你就应该重构。

      在极限编程里有这么一种观点：重构可以取代预先设计，就是说你根本不必做任何设计，只管按照最初想法开始编码，让代码有效运作，然后再将它重构成型。其实，我个人还是不同意这个观点的。因为一个系统的开始之初，肯定会伴随着一个设计思路的诞生。设计思路的诞生，必然会让我们联系自己的一些过往经验，评估出一种高可行、高稳定的方案出来。但是在这个过程中，不管多牛的人，都不可能设计出100%完美的系统。所以这个时候重构就将作为一种重要的手段，牵着系统走向完美、稳定之路。下面的内容将具体讲解一下，重构的典型案例，以及如果重构。





